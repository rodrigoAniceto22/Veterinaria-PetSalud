{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services/factura.service\";\nimport * as i3 from \"../../services/dueno.service\";\nimport * as i4 from \"../../services/notificacion.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/common\";\nfunction FacturaFormComponent_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Nueva Factura\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FacturaFormComponent_span_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Editar Factura\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FacturaFormComponent_span_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Detalle de Factura\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FacturaFormComponent_div_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵelement(1, \"div\", 14);\n    i0.ɵɵelementStart(2, \"p\", 15);\n    i0.ɵɵtext(3, \"Cargando informaci\\u00F3n...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction FacturaFormComponent_div_22_option_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 69);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const dueno_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", dueno_r3.idDueno);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", dueno_r3.nombres, \" \", dueno_r3.apellidos, \" - \", dueno_r3.dni, \" \");\n  }\n}\nfunction FacturaFormComponent_div_22_option_66_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 69);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const metodo_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", metodo_r4);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(metodo_r4);\n  }\n}\nfunction FacturaFormComponent_div_22_button_76_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 70);\n    i0.ɵɵlistener(\"click\", function FacturaFormComponent_div_22_button_76_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.agregarDetalle());\n    });\n    i0.ɵɵelement(1, \"i\", 71);\n    i0.ɵɵtext(2, \"Agregar Detalle \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FacturaFormComponent_div_22_div_78_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 72);\n    i0.ɵɵelement(1, \"i\", 73);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"No hay detalles. Agregue al menos uno.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction FacturaFormComponent_div_22_div_80_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 85);\n    i0.ɵɵlistener(\"click\", function FacturaFormComponent_div_22_div_80_button_4_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const i_r7 = i0.ɵɵnextContext().index;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.eliminarDetalle(i_r7));\n    });\n    i0.ɵɵelement(1, \"i\", 86);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FacturaFormComponent_div_22_div_80_option_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 69);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const tipo_r8 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", tipo_r8);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(tipo_r8);\n  }\n}\nfunction FacturaFormComponent_div_22_div_80_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 74)(1, \"div\", 75)(2, \"h6\", 21);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, FacturaFormComponent_div_22_div_80_button_4_Template, 2, 0, \"button\", 76);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 17)(6, \"div\", 77)(7, \"label\", 26);\n    i0.ɵɵtext(8, \"Descripci\\u00F3n \");\n    i0.ɵɵelementStart(9, \"span\", 27);\n    i0.ɵɵtext(10, \"*\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(11, \"input\", 78);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 77)(13, \"label\", 26);\n    i0.ɵɵtext(14, \"Tipo de Servicio\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"select\", 79);\n    i0.ɵɵtemplate(16, FacturaFormComponent_div_22_div_80_option_16_Template, 2, 2, \"option\", 37);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(17, \"div\", 80)(18, \"label\", 26);\n    i0.ɵɵtext(19, \"Cantidad \");\n    i0.ɵɵelementStart(20, \"span\", 27);\n    i0.ɵɵtext(21, \"*\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(22, \"input\", 81);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 80)(24, \"label\", 26);\n    i0.ɵɵtext(25, \"Precio Unitario \");\n    i0.ɵɵelementStart(26, \"span\", 27);\n    i0.ɵɵtext(27, \"*\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(28, \"div\", 82)(29, \"span\", 29);\n    i0.ɵɵtext(30, \"S/.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(31, \"input\", 83);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(32, \"div\", 80)(33, \"label\", 26);\n    i0.ɵɵtext(34, \"Subtotal\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(35, \"div\", 82)(36, \"span\", 29);\n    i0.ɵɵtext(37, \"S/.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(38, \"input\", 84);\n    i0.ɵɵpipe(39, \"number\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const detalle_r9 = ctx.$implicit;\n    const i_r7 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"formGroupName\", i_r7);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Detalle #\", i_r7 + 1, \"\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.modoVista && ctx_r1.detalles.length > 1);\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.tiposServicio);\n    i0.ɵɵadvance(22);\n    i0.ɵɵproperty(\"value\", i0.ɵɵpipeBind2(39, 5, ctx_r1.calcularSubtotalDetalle(detalle_r9.value), \"1.2-2\"));\n  }\n}\nfunction FacturaFormComponent_div_22_button_108_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 87);\n    i0.ɵɵlistener(\"click\", function FacturaFormComponent_div_22_button_108_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.editar());\n    });\n    i0.ɵɵelement(1, \"i\", 88);\n    i0.ɵɵtext(2, \"Editar \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FacturaFormComponent_div_22_button_109_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵelement(1, \"i\", 90);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r1.modoEdicion ? \"Actualizar\" : \"Guardar\", \" \");\n  }\n}\nfunction FacturaFormComponent_div_22_button_109_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵelement(1, \"span\", 91);\n    i0.ɵɵtext(2, \"Guardando... \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FacturaFormComponent_div_22_button_109_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 89);\n    i0.ɵɵtemplate(1, FacturaFormComponent_div_22_button_109_span_1_Template, 3, 1, \"span\", 3)(2, FacturaFormComponent_div_22_button_109_span_2_Template, 3, 0, \"span\", 3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.guardando || ctx_r1.facturaForm.invalid || ctx_r1.detalles.length === 0);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.guardando);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.guardando);\n  }\n}\nfunction FacturaFormComponent_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"form\", 16);\n    i0.ɵɵlistener(\"ngSubmit\", function FacturaFormComponent_div_22_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onSubmit());\n    });\n    i0.ɵɵelementStart(2, \"div\", 17)(3, \"div\", 18)(4, \"div\", 19)(5, \"div\", 20)(6, \"h5\", 21);\n    i0.ɵɵelement(7, \"i\", 22);\n    i0.ɵɵtext(8, \"Informaci\\u00F3n General\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"div\", 23)(10, \"div\", 24)(11, \"div\", 25)(12, \"label\", 26);\n    i0.ɵɵtext(13, \"N\\u00B0 Factura \");\n    i0.ɵɵelementStart(14, \"span\", 27);\n    i0.ɵɵtext(15, \"*\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 28)(17, \"span\", 29);\n    i0.ɵɵelement(18, \"i\", 30);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(19, \"input\", 31);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"div\", 25)(21, \"label\", 26);\n    i0.ɵɵtext(22, \"Fecha Emisi\\u00F3n \");\n    i0.ɵɵelementStart(23, \"span\", 27);\n    i0.ɵɵtext(24, \"*\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(25, \"div\", 28)(26, \"span\", 29);\n    i0.ɵɵelement(27, \"i\", 32);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(28, \"input\", 33);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(29, \"div\", 24)(30, \"div\", 25)(31, \"label\", 26);\n    i0.ɵɵtext(32, \"Cliente \");\n    i0.ɵɵelementStart(33, \"span\", 27);\n    i0.ɵɵtext(34, \"*\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(35, \"div\", 28)(36, \"span\", 29);\n    i0.ɵɵelement(37, \"i\", 34);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(38, \"select\", 35)(39, \"option\", 36);\n    i0.ɵɵtext(40, \"Seleccione un cliente\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(41, FacturaFormComponent_div_22_option_41_Template, 2, 4, \"option\", 37);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(42, \"div\", 25)(43, \"label\", 26);\n    i0.ɵɵtext(44, \"Fecha Vencimiento\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"div\", 28)(46, \"span\", 29);\n    i0.ɵɵelement(47, \"i\", 38);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(48, \"input\", 39);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(49, \"div\", 24)(50, \"div\", 25)(51, \"label\", 26);\n    i0.ɵɵtext(52, \"Estado\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(53, \"select\", 40)(54, \"option\", 41);\n    i0.ɵɵtext(55, \"PENDIENTE\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(56, \"option\", 42);\n    i0.ɵɵtext(57, \"PAGADA\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(58, \"option\", 43);\n    i0.ɵɵtext(59, \"ANULADA\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(60, \"div\", 25)(61, \"label\", 26);\n    i0.ɵɵtext(62, \"M\\u00E9todo de Pago\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(63, \"select\", 44)(64, \"option\", 36);\n    i0.ɵɵtext(65, \"Seleccione m\\u00E9todo\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(66, FacturaFormComponent_div_22_option_66_Template, 2, 2, \"option\", 37);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(67, \"div\", 45)(68, \"label\", 26);\n    i0.ɵɵtext(69, \"Observaciones\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(70, \"textarea\", 46);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(71, \"div\", 19)(72, \"div\", 47)(73, \"h5\", 21);\n    i0.ɵɵelement(74, \"i\", 48);\n    i0.ɵɵtext(75, \"Detalles de Factura\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(76, FacturaFormComponent_div_22_button_76_Template, 3, 0, \"button\", 49);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(77, \"div\", 23);\n    i0.ɵɵtemplate(78, FacturaFormComponent_div_22_div_78_Template, 4, 0, \"div\", 50);\n    i0.ɵɵelementStart(79, \"div\", 51);\n    i0.ɵɵtemplate(80, FacturaFormComponent_div_22_div_80_Template, 40, 8, \"div\", 52);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(81, \"div\", 53)(82, \"div\", 54)(83, \"div\", 55)(84, \"h5\", 21);\n    i0.ɵɵelement(85, \"i\", 56);\n    i0.ɵɵtext(86, \"Resumen\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(87, \"div\", 23)(88, \"div\", 57)(89, \"span\");\n    i0.ɵɵtext(90, \"Subtotal:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(91, \"strong\");\n    i0.ɵɵtext(92);\n    i0.ɵɵpipe(93, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(94, \"div\", 57)(95, \"span\");\n    i0.ɵɵtext(96, \"IGV (18%):\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(97, \"strong\");\n    i0.ɵɵtext(98);\n    i0.ɵɵpipe(99, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(100, \"hr\");\n    i0.ɵɵelementStart(101, \"div\", 58)(102, \"h5\");\n    i0.ɵɵtext(103, \"Total:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(104, \"h5\", 59);\n    i0.ɵɵtext(105);\n    i0.ɵɵpipe(106, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(107, \"div\", 60);\n    i0.ɵɵtemplate(108, FacturaFormComponent_div_22_button_108_Template, 3, 0, \"button\", 61)(109, FacturaFormComponent_div_22_button_109_Template, 3, 3, \"button\", 62);\n    i0.ɵɵelementStart(110, \"button\", 63);\n    i0.ɵɵlistener(\"click\", function FacturaFormComponent_div_22_Template_button_click_110_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.volver());\n    });\n    i0.ɵɵelement(111, \"i\", 64);\n    i0.ɵɵtext(112, \"Cancelar \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(113, \"div\", 65)(114, \"div\", 23)(115, \"h6\", 66);\n    i0.ɵɵelement(116, \"i\", 67);\n    i0.ɵɵtext(117, \"Informaci\\u00F3n\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(118, \"small\", 68);\n    i0.ɵɵtext(119, \" \\u2022 El IGV se calcula autom\\u00E1ticamente (18%)\");\n    i0.ɵɵelement(120, \"br\");\n    i0.ɵɵtext(121, \" \\u2022 Agregue todos los servicios prestados\");\n    i0.ɵɵelement(122, \"br\");\n    i0.ɵɵtext(123, \" \\u2022 El n\\u00FAmero de factura es \\u00FAnico \");\n    i0.ɵɵelementEnd()()()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.facturaForm);\n    i0.ɵɵadvance(18);\n    i0.ɵɵclassProp(\"is-invalid\", (ctx_r1.numeroFactura == null ? null : ctx_r1.numeroFactura.invalid) && (ctx_r1.numeroFactura == null ? null : ctx_r1.numeroFactura.touched));\n    i0.ɵɵadvance(9);\n    i0.ɵɵclassProp(\"is-invalid\", (ctx_r1.fechaEmision == null ? null : ctx_r1.fechaEmision.invalid) && (ctx_r1.fechaEmision == null ? null : ctx_r1.fechaEmision.touched));\n    i0.ɵɵadvance(10);\n    i0.ɵɵclassProp(\"is-invalid\", (ctx_r1.idDueno == null ? null : ctx_r1.idDueno.invalid) && (ctx_r1.idDueno == null ? null : ctx_r1.idDueno.touched));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.duenos);\n    i0.ɵɵadvance(25);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.metodosPago);\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.modoVista);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.detalles.length === 0);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.detalles.controls);\n    i0.ɵɵadvance(12);\n    i0.ɵɵtextInterpolate1(\"S/. \", i0.ɵɵpipeBind2(93, 17, ctx_r1.subtotal, \"1.2-2\"), \"\");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\"S/. \", i0.ɵɵpipeBind2(99, 20, ctx_r1.igv, \"1.2-2\"), \"\");\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\"S/. \", i0.ɵɵpipeBind2(106, 23, ctx_r1.total, \"1.2-2\"), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.modoVista);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.modoVista);\n  }\n}\nexport let FacturaFormComponent = /*#__PURE__*/(() => {\n  class FacturaFormComponent {\n    fb;\n    facturaService;\n    duenoService;\n    notificacionService;\n    router;\n    route;\n    facturaForm;\n    modoEdicion = false;\n    modoVista = false;\n    facturaId = null;\n    loading = false;\n    guardando = false;\n    // Catálogos\n    duenos = [];\n    metodosPago = ['EFECTIVO', 'TARJETA', 'TRANSFERENCIA', 'YAPE', 'PLIN'];\n    tiposServicio = ['EXAMEN', 'CONSULTA', 'MEDICAMENTO', 'VACUNA', 'CIRUGIA', 'OTROS'];\n    // Cálculos\n    subtotal = 0;\n    igv = 0;\n    total = 0;\n    IGV_PORCENTAJE = 0.18;\n    constructor(fb, facturaService, duenoService, notificacionService, router, route) {\n      this.fb = fb;\n      this.facturaService = facturaService;\n      this.duenoService = duenoService;\n      this.notificacionService = notificacionService;\n      this.router = router;\n      this.route = route;\n    }\n    ngOnInit() {\n      this.cargarDuenos();\n      this.inicializarFormulario();\n      this.verificarModo();\n    }\n    inicializarFormulario() {\n      this.facturaForm = this.fb.group({\n        numeroFactura: ['', [Validators.required]],\n        fechaEmision: [this.obtenerFechaActual(), [Validators.required]],\n        fechaVencimiento: [''],\n        idDueno: ['', [Validators.required]],\n        estado: ['PENDIENTE'],\n        metodoPago: [''],\n        fechaPago: [''],\n        observaciones: [''],\n        detalles: this.fb.array([])\n      });\n      // Generar número de factura automático\n      this.generarNumeroFactura();\n      // Agregar un detalle inicial\n      this.agregarDetalle();\n    }\n    cargarDuenos() {\n      this.duenoService.listarTodos().subscribe({\n        next: data => {\n          this.duenos = data;\n        },\n        error: error => {\n          console.error('Error al cargar dueños:', error);\n        }\n      });\n    }\n    verificarModo() {\n      const url = this.router.url;\n      this.modoVista = url.includes('/ver/');\n      this.route.params.subscribe(params => {\n        if (params['id']) {\n          this.facturaId = +params['id'];\n          this.modoEdicion = !this.modoVista;\n          this.cargarFactura(this.facturaId);\n        }\n      });\n      if (this.modoVista) {\n        this.facturaForm.disable();\n      }\n    }\n    cargarFactura(id) {\n      this.loading = true;\n      this.facturaService.obtenerPorId(id).subscribe({\n        next: factura => {\n          this.facturaForm.patchValue({\n            numeroFactura: factura.numeroFactura,\n            fechaEmision: factura.fechaEmision,\n            fechaVencimiento: factura.fechaVencimiento,\n            idDueno: factura.dueno?.idDueno,\n            estado: factura.estado,\n            metodoPago: factura.metodoPago,\n            fechaPago: factura.fechaPago,\n            observaciones: factura.observaciones\n          });\n          // Cargar detalles\n          this.detalles.clear();\n          if (factura.detalles && factura.detalles.length > 0) {\n            factura.detalles.forEach(detalle => {\n              this.detalles.push(this.fb.group({\n                descripcion: [detalle.descripcion, Validators.required],\n                cantidad: [detalle.cantidad, [Validators.required, Validators.min(1)]],\n                precioUnitario: [detalle.precioUnitario, [Validators.required, Validators.min(0)]],\n                tipoServicio: [detalle.tipoServicio]\n              }));\n            });\n          }\n          this.calcularTotales();\n          this.loading = false;\n        },\n        error: error => {\n          console.error('Error al cargar factura:', error);\n          this.notificacionService.errorGeneral();\n          this.volver();\n        }\n      });\n    }\n    get detalles() {\n      return this.facturaForm.get('detalles');\n    }\n    agregarDetalle() {\n      const detalleGroup = this.fb.group({\n        descripcion: ['', Validators.required],\n        cantidad: [1, [Validators.required, Validators.min(1)]],\n        precioUnitario: [0, [Validators.required, Validators.min(0)]],\n        tipoServicio: ['EXAMEN']\n      });\n      // Escuchar cambios para recalcular\n      detalleGroup.valueChanges.subscribe(() => {\n        this.calcularTotales();\n      });\n      this.detalles.push(detalleGroup);\n    }\n    eliminarDetalle(index) {\n      if (this.detalles.length > 1) {\n        this.detalles.removeAt(index);\n        this.calcularTotales();\n      } else {\n        this.notificacionService.warning('Debe haber al menos un detalle');\n      }\n    }\n    calcularSubtotalDetalle(detalle) {\n      return (detalle.cantidad || 0) * (detalle.precioUnitario || 0);\n    }\n    calcularTotales() {\n      this.subtotal = 0;\n      this.detalles.controls.forEach(control => {\n        const detalle = control.value;\n        this.subtotal += this.calcularSubtotalDetalle(detalle);\n      });\n      this.igv = this.subtotal * this.IGV_PORCENTAJE;\n      this.total = this.subtotal + this.igv;\n    }\n    generarNumeroFactura() {\n      const fecha = new Date();\n      const año = fecha.getFullYear();\n      const mes = String(fecha.getMonth() + 1).padStart(2, '0');\n      const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');\n      this.facturaForm.patchValue({\n        numeroFactura: `F${año}${mes}-${random}`\n      });\n    }\n    obtenerFechaActual() {\n      return new Date().toISOString().split('T')[0];\n    }\n    onSubmit() {\n      if (this.facturaForm.invalid) {\n        this.marcarCamposComoTocados();\n        this.notificacionService.warning('Complete todos los campos requeridos');\n        return;\n      }\n      if (this.detalles.length === 0) {\n        this.notificacionService.warning('Debe agregar al menos un detalle');\n        return;\n      }\n      this.guardando = true;\n      const factura = {\n        ...this.facturaForm.value,\n        subtotal: this.subtotal,\n        igv: this.igv,\n        total: this.total,\n        dueno: {\n          idDueno: this.facturaForm.value.idDueno\n        },\n        detalles: this.detalles.value.map(d => ({\n          ...d,\n          subtotal: this.calcularSubtotalDetalle(d)\n        }))\n      };\n      const operacion = this.modoEdicion ? this.facturaService.actualizar(this.facturaId, factura) : this.facturaService.crear(factura);\n      operacion.subscribe({\n        next: () => {\n          const mensaje = this.modoEdicion ? 'actualizada' : 'creada';\n          this.notificacionService.success(`Factura ${mensaje} exitosamente`);\n          this.volver();\n        },\n        error: error => {\n          console.error('Error al guardar:', error);\n          this.notificacionService.errorGeneral();\n          this.guardando = false;\n        }\n      });\n    }\n    marcarCamposComoTocados() {\n      Object.keys(this.facturaForm.controls).forEach(key => {\n        this.facturaForm.get(key)?.markAsTouched();\n      });\n      this.detalles.controls.forEach(control => {\n        Object.keys(control.controls).forEach(key => {\n          control.get(key)?.markAsTouched();\n        });\n      });\n    }\n    volver() {\n      this.router.navigate(['/facturas']);\n    }\n    editar() {\n      this.router.navigate(['/facturas/editar', this.facturaId]);\n    }\n    get numeroFactura() {\n      return this.facturaForm.get('numeroFactura');\n    }\n    get fechaEmision() {\n      return this.facturaForm.get('fechaEmision');\n    }\n    get idDueno() {\n      return this.facturaForm.get('idDueno');\n    }\n    static ɵfac = function FacturaFormComponent_Factory(t) {\n      return new (t || FacturaFormComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.FacturaService), i0.ɵɵdirectiveInject(i3.DuenoService), i0.ɵɵdirectiveInject(i4.NotificacionService), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i5.ActivatedRoute));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: FacturaFormComponent,\n      selectors: [[\"app-factura-form\"]],\n      decls: 23,\n      vars: 6,\n      consts: [[1, \"container-fluid\", \"py-4\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mb-4\"], [1, \"fas\", \"fa-file-invoice-dollar\", \"me-2\"], [4, \"ngIf\"], [\"aria-label\", \"breadcrumb\"], [1, \"breadcrumb\"], [1, \"breadcrumb-item\"], [\"routerLink\", \"/dashboard\"], [\"routerLink\", \"/facturas\"], [1, \"breadcrumb-item\", \"active\"], [1, \"btn\", \"btn-outline-secondary\", 3, \"click\"], [1, \"fas\", \"fa-arrow-left\", \"me-2\"], [\"class\", \"text-center py-5\", 4, \"ngIf\"], [1, \"text-center\", \"py-5\"], [1, \"spinner-border\", \"text-primary\"], [1, \"mt-3\"], [3, \"ngSubmit\", \"formGroup\"], [1, \"row\"], [1, \"col-lg-8\"], [1, \"card\", \"shadow-sm\", \"mb-3\"], [1, \"card-header\", \"bg-primary\", \"text-white\"], [1, \"mb-0\"], [1, \"fas\", \"fa-info-circle\", \"me-2\"], [1, \"card-body\"], [1, \"row\", \"mb-3\"], [1, \"col-md-6\"], [1, \"form-label\"], [1, \"text-danger\"], [1, \"input-group\"], [1, \"input-group-text\"], [1, \"fas\", \"fa-hashtag\"], [\"type\", \"text\", \"formControlName\", \"numeroFactura\", 1, \"form-control\"], [1, \"fas\", \"fa-calendar\"], [\"type\", \"date\", \"formControlName\", \"fechaEmision\", 1, \"form-control\"], [1, \"fas\", \"fa-user\"], [\"formControlName\", \"idDueno\", 1, \"form-select\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"fas\", \"fa-calendar-alt\"], [\"type\", \"date\", \"formControlName\", \"fechaVencimiento\", 1, \"form-control\"], [\"formControlName\", \"estado\", 1, \"form-select\"], [\"value\", \"PENDIENTE\"], [\"value\", \"PAGADA\"], [\"value\", \"ANULADA\"], [\"formControlName\", \"metodoPago\", 1, \"form-select\"], [1, \"mb-3\"], [\"formControlName\", \"observaciones\", \"rows\", \"2\", 1, \"form-control\"], [1, \"card-header\", \"bg-info\", \"text-white\", \"d-flex\", \"justify-content-between\", \"align-items-center\"], [1, \"fas\", \"fa-list\", \"me-2\"], [\"type\", \"button\", \"class\", \"btn btn-light btn-sm\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"text-center py-4 text-muted\", 4, \"ngIf\"], [\"formArrayName\", \"detalles\"], [\"class\", \"detalle-item mb-3 p-3 border rounded\", 3, \"formGroupName\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-lg-4\"], [1, \"card\", \"shadow-sm\", \"mb-3\", \"sticky-top\", 2, \"top\", \"20px\"], [1, \"card-header\", \"bg-success\", \"text-white\"], [1, \"fas\", \"fa-calculator\", \"me-2\"], [1, \"d-flex\", \"justify-content-between\", \"mb-2\"], [1, \"d-flex\", \"justify-content-between\"], [1, \"text-success\"], [1, \"d-grid\", \"gap-2\", \"mt-4\"], [\"type\", \"button\", \"class\", \"btn btn-warning\", 3, \"click\", 4, \"ngIf\"], [\"type\", \"submit\", \"class\", \"btn btn-primary\", 3, \"disabled\", 4, \"ngIf\"], [\"type\", \"button\", 1, \"btn\", \"btn-secondary\", 3, \"click\"], [1, \"fas\", \"fa-times\", \"me-2\"], [1, \"card\", \"shadow-sm\", \"border-info\"], [1, \"text-info\"], [1, \"fas\", \"fa-lightbulb\", \"me-2\"], [1, \"text-muted\"], [3, \"value\"], [\"type\", \"button\", 1, \"btn\", \"btn-light\", \"btn-sm\", 3, \"click\"], [1, \"fas\", \"fa-plus\", \"me-1\"], [1, \"text-center\", \"py-4\", \"text-muted\"], [1, \"fas\", \"fa-inbox\", \"fa-2x\", \"mb-2\"], [1, \"detalle-item\", \"mb-3\", \"p-3\", \"border\", \"rounded\", 3, \"formGroupName\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mb-2\"], [\"type\", \"button\", \"class\", \"btn btn-sm btn-outline-danger\", 3, \"click\", 4, \"ngIf\"], [1, \"col-md-6\", \"mb-2\"], [\"type\", \"text\", \"formControlName\", \"descripcion\", \"placeholder\", \"Ej: Hemograma completo\", 1, \"form-control\", \"form-control-sm\"], [\"formControlName\", \"tipoServicio\", 1, \"form-select\", \"form-select-sm\"], [1, \"col-md-4\", \"mb-2\"], [\"type\", \"number\", \"formControlName\", \"cantidad\", \"min\", \"1\", 1, \"form-control\", \"form-control-sm\"], [1, \"input-group\", \"input-group-sm\"], [\"type\", \"number\", \"formControlName\", \"precioUnitario\", \"min\", \"0\", \"step\", \"0.01\", 1, \"form-control\"], [\"type\", \"text\", \"readonly\", \"\", 1, \"form-control\", 3, \"value\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-outline-danger\", 3, \"click\"], [1, \"fas\", \"fa-trash\"], [\"type\", \"button\", 1, \"btn\", \"btn-warning\", 3, \"click\"], [1, \"fas\", \"fa-edit\", \"me-2\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [1, \"fas\", \"fa-save\", \"me-2\"], [1, \"spinner-border\", \"spinner-border-sm\", \"me-2\"]],\n      template: function FacturaFormComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\")(3, \"h2\");\n          i0.ɵɵelement(4, \"i\", 2);\n          i0.ɵɵtemplate(5, FacturaFormComponent_span_5_Template, 2, 0, \"span\", 3)(6, FacturaFormComponent_span_6_Template, 2, 0, \"span\", 3)(7, FacturaFormComponent_span_7_Template, 2, 0, \"span\", 3);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(8, \"nav\", 4)(9, \"ol\", 5)(10, \"li\", 6)(11, \"a\", 7);\n          i0.ɵɵtext(12, \"Dashboard\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(13, \"li\", 6)(14, \"a\", 8);\n          i0.ɵɵtext(15, \"Facturas\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(16, \"li\", 9);\n          i0.ɵɵtext(17);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(18, \"button\", 10);\n          i0.ɵɵlistener(\"click\", function FacturaFormComponent_Template_button_click_18_listener() {\n            return ctx.volver();\n          });\n          i0.ɵɵelement(19, \"i\", 11);\n          i0.ɵɵtext(20, \"Volver \");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(21, FacturaFormComponent_div_21_Template, 4, 0, \"div\", 12)(22, FacturaFormComponent_div_22_Template, 124, 26, \"div\", 3);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngIf\", !ctx.modoEdicion && !ctx.modoVista);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.modoEdicion);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.modoVista);\n          i0.ɵɵadvance(10);\n          i0.ɵɵtextInterpolate(ctx.modoEdicion ? \"Editar\" : ctx.modoVista ? \"Ver\" : \"Nueva\");\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n        }\n      },\n      dependencies: [i6.NgForOf, i6.NgIf, i5.RouterLink, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.MinValidator, i1.FormGroupDirective, i1.FormControlName, i1.FormGroupName, i1.FormArrayName, i6.DecimalPipe],\n      styles: [\".card[_ngcontent-%COMP%]{border-radius:10px}.card-header[_ngcontent-%COMP%]{border-radius:10px 10px 0 0!important}.detalle-item[_ngcontent-%COMP%]{background-color:#f8f9fa;transition:all .3s}.detalle-item[_ngcontent-%COMP%]:hover{background-color:#e9ecef;box-shadow:0 2px 4px #0000001a}.sticky-top[_ngcontent-%COMP%]{position:sticky;z-index:100}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#667eea;box-shadow:0 0 0 .2rem #667eea40}.input-group-text[_ngcontent-%COMP%]{background-color:#f8f9fa}hr[_ngcontent-%COMP%]{border-top:2px solid #dee2e6}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:.5rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}\"]\n    });\n  }\n  return FacturaFormComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}