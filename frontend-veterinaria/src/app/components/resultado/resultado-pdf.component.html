<div class="container-fluid py-4">
  
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2><i class="fas fa-file-pdf me-2"></i>Informe PDF - Resultado</h2>
      <p class="text-muted" *ngIf="resultado">
        Resultado #{{ resultadoId }} - {{ resultado.orden?.tipoExamen }}
      </p>
    </div>
    <button class="btn btn-outline-secondary" (click)="volver()">
      <i class="fas fa-arrow-left me-2"></i>Volver
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-3">Cargando información del resultado...</p>
  </div>

  <!-- Contenido Principal -->
  <div *ngIf="!loading" class="row">
    
    <!-- Barra de Acciones -->
    <div class="col-12 mb-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-0">
                <i class="fas fa-tools me-2"></i>Acciones del Documento
              </h5>
            </div>
            <div class="btn-group">
              <button class="btn btn-primary" (click)="descargarPDF()">
                <i class="fas fa-download me-2"></i>Descargar PDF
              </button>
              <button class="btn btn-info" (click)="imprimirPDF()">
                <i class="fas fa-print me-2"></i>Imprimir
              </button>
              <button class="btn btn-success" (click)="enviarPorEmail()">
                <i class="fas fa-envelope me-2"></i>Enviar por Email
              </button>
              <button class="btn btn-secondary" (click)="verDetalle()">
                <i class="fas fa-eye me-2"></i>Ver Detalles
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Información del Resultado -->
    <div class="col-12 mb-3" *ngIf="resultado">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Información del Resultado</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-3">
              <p class="mb-2">
                <strong><i class="fas fa-hashtag me-1"></i> ID:</strong> 
                {{ resultado.idResultado }}
              </p>
              <p class="mb-2">
                <strong><i class="fas fa-calendar me-1"></i> Fecha:</strong> 
                {{ resultado.fechaResultado | date:'dd/MM/yyyy HH:mm' }}
              </p>
            </div>
            <div class="col-md-3">
              <p class="mb-2">
                <strong><i class="fas fa-file-prescription me-1"></i> Orden:</strong> 
                #{{ resultado.orden?.idOrden }}
              </p>
              <p class="mb-2">
                <strong><i class="fas fa-vial me-1"></i> Tipo Examen:</strong> 
                {{ resultado.orden?.tipoExamen }}
              </p>
            </div>
            <div class="col-md-3">
              <p class="mb-2">
                <strong><i class="fas fa-dog me-1"></i> Mascota:</strong> 
                {{ resultado.orden?.mascota?.nombre }}
              </p>
              <p class="mb-2">
                <strong><i class="fas fa-user me-1"></i> Dueño:</strong> 
                {{ resultado.orden?.mascota?.dueno?.nombres }}
              </p>
            </div>
            <div class="col-md-3">
              <p class="mb-2">
                <strong><i class="fas fa-check-circle me-1"></i> Validado:</strong> 
                <span class="badge bg-success" *ngIf="resultado.validado">Sí</span>
                <span class="badge bg-warning" *ngIf="!resultado.validado">No</span>
              </p>
              <p class="mb-2">
                <strong><i class="fas fa-hand-holding me-1"></i> Entregado:</strong> 
                <span class="badge bg-success" *ngIf="resultado.entregado">Sí</span>
                <span class="badge bg-secondary" *ngIf="!resultado.entregado">No</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista Previa del PDF -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="fas fa-file-pdf me-2"></i>Vista Previa del Documento</h5>
        </div>
        <div class="card-body p-0">
          
          <!-- Generando PDF -->
          <div *ngIf="generandoPDF" class="text-center py-5">
            <div class="spinner-border text-primary mb-3" role="status"></div>
            <p class="text-muted">Generando documento PDF...</p>
          </div>

          <!-- PDF Viewer -->
          <div *ngIf="!generandoPDF && pdfUrl" class="pdf-container">
            <iframe [src]="pdfUrl" 
                    width="100%" 
                    height="800px"
                    frameborder="0">
            </iframe>
          </div>

          <!-- Error al cargar PDF -->
          <div *ngIf="!generandoPDF && !pdfUrl" class="text-center py-5">
            <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
            <p class="text-muted">No se pudo cargar la vista previa del PDF</p>
            <button class="btn btn-primary" (click)="generarVistaPrevia()">
              <i class="fas fa-redo me-2"></i>Reintentar
            </button>
          </div>
        </div>
        
        <!-- Footer con información adicional -->
        <div class="card-footer bg-light">
          <div class="d-flex justify-content-between align-items-center">
            <small class="text-muted">
              <i class="fas fa-info-circle me-1"></i>
              Documento generado automáticamente por el Sistema de Gestión Veterinaria PetSalud
            </small>
            <small class="text-muted">
              <i class="fas fa-clock me-1"></i>
              Generado el: {{ Date.now() | date:'dd/MM/yyyy HH:mm' }}
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Instrucciones -->
  <div class="row mt-3">
    <div class="col-12">
      <div class="alert alert-info" role="alert">
        <h6 class="alert-heading">
          <i class="fas fa-lightbulb me-2"></i>Instrucciones
        </h6>
        <ul class="mb-0">
          <li>Puede descargar el PDF haciendo clic en el botón "Descargar PDF"</li>
          <li>Para imprimir directamente, use el botón "Imprimir"</li>
          <li>El documento PDF incluye código QR para verificación de autenticidad</li>
          <li>Este documento tiene validez oficial una vez validado por el veterinario</li>
        </ul>
      </div>
    </div>
  </div>
</div>